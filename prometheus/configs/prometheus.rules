groups:
  - name: kafka alerts
    rules:
    - alert: Low Rate Messages Produced
      expr: sum(delta(kafka_topic_partition_current_offset{topic=~"api-result"}[5m])/5) by (topic) < 5
      for: 1m
      labels:
          severity: warning
      annotations:
          summary: Low rate of messages produced
    - alert: Low Rate Messages Consumed
      expr: kafka_topic_partition_current_offset{partition=~'0', instance=~'$instance', topic=~"$topic"} - on() kafka_consumergroup_current_offset{instance=~'$instance',topic=~"$topic"}
      for: 1m
      labels:
          severity: warning
      annotations:
          summary: Low rate of messages consumed
  - name: kubernetes alerts
    rules:
    - alert: High Pod Requested
      expr: sum(kube_pod_info) / sum(kube_node_status_allocatable{resource="pods"}) * 100 > 80
      for: 2m
      labels:
          severity: warning
      annotations:
          summary: More than 80% number of pods available has been requested
    - alert: Very High Pod Requested
      expr: sum(kube_pod_info) / sum(kube_node_status_allocatable{resource="pods"}) * 100 > 90
      for: 2m
      labels:
          severity: critical
      annotations:
          summary: More than 90% number of pods available has been requested
    - alert: High Pod CPU Requested
      expr: sum(kube_pod_container_resource_requests{resource="cpu"})/ sum(kube_node_status_allocatable{resource="cpu"}) * 100 > 80
      for: 2m
      labels:
          severity: warning
      annotations:
          summary: More than 80% CPU available has been requested from the pods
    - alert: Very High Pod CPU Requested
      expr: sum(kube_pod_container_resource_requests{resource="cpu"})/ sum(kube_node_status_allocatable{resource="cpu"}) * 100 > 90
      for: 2m
      labels:
          severity: critical
      annotations:
          summary: More than 90% CPU available has been requested from the pods
    - alert: High Pod Memory
      expr: sum(kube_pod_container_resource_requests{resource="memory"}) / sum(kube_node_status_allocatable{resource="memory"}) * 100 > 80
      for: 2m
      labels:
          severity: warning
      annotations:
          summary: More than 80% of memory available has been requested from the pods
    - alert: Very High Pod Memory
      expr: sum(kube_pod_container_resource_requests{resource="memory"}) / sum(kube_node_status_allocatable{resource="memory"}) * 100 > 90
      for: 2m
      labels:
          severity: critical
      annotations:
          summary: More than 90% of memory available has been requested from the pods
    - alert: Node Unavailable
      expr: sum(kube_node_info) < 1
      for: 2m
      labels:
          severity: critical
      annotations:
          summary: 0 node available inside the cluster
    - alert: PVC Not Bound
      expr: sum(kube_persistentvolumeclaim_status_phase{phase="Bound"}) < 1
      for: 2m
      labels:
          severity: critical
      annotations:
          summary: The persistent volume claim is not bound
